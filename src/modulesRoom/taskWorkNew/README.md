# 房间工作任务模块

房间工作任务是指那些需要消耗能量的工作，例如升级、建造、刷墙、维修等，而执行这些任务的 creep 下文将简称为工人。工作任务拥有以下特点：

- **工作时长不固定**：如修路这种小任务，无法填满一个 creep 的生命周期，使用角色驱动容易造成浪费。
- **拥有统一的高层调度需求**：例如在遭遇核弹袭击时，需要停止升级、建造等工作，所有工人一起在落点刷墙。

为了解决上述两个痛点，选择使用任务驱动的形式对其进行管理。

## 优先级安排

对 **升级、建造、刷墙、维修** 四大任务的优先级安排如下：

- 建造优先级最高，因为建造可以快速提高房间的产出能力。
- 维修的优先级次之，因为维修并不常见，且后期由 tower 负责。
- 升级的优先级第三，因为上面两个是偶发任务，升级是常驻任务，在 RCL 升级时允许暂时没有升级工，全力建造建筑。
- 刷墙的优先级最低，但是在关键情况下（主动防御、发现核弹）将提升至最高优先级。

## 工作期望

该模块暴露了一个方法 `getExpect`，该方法接受当前房间内可以使用的能量总量，返回当前工人的调整额度（如返回 2 代表可以增加两个工人，返回 -1 代表可以削减一个工人），注意这个方法并非强制调用，你可以在某些时期，如 RCL8 后固定只孵化一个工人，或者用你自己的期望模块管理工人数量。

## 为什么采集任务（采能量、采矿）不并入工作任务

- 采集任务和任务模块的特性不符

    上面提到了任务模块的两个开发目的，而采集任务工作时长很固定（生下来采集到死），且没有调度需求（无论工作任务怎么增减调度、采集任务都是需要存在的，尤其是能量采集任务），所以采集任务完全用不到任务模块

- 采集任务内聚性高，放在任务模块里只会提高复杂程度

    能量采集的单位包含多个采集模式，例如 container 采集、link 采集等。并且需要监听自身及周边状态自适应的调整模块，这些逻辑和任务模块完全没有关系，放在任务模块中只会导致采集任务内聚性降低。

- 由于上述两条，并入采集任务需要改造任务模块，会添加很多不优雅的逻辑

    例如，工作任务会根据当前房间可用能量给出工人调整期望，但是采集单位不会因为可用能量降低而消失，如果并入采集任务的话，在房间可用能量降低时，反而需要提高工人数量来采集能量，这非常反直觉。并且采集任务的优先级远远高于其他工作任务，所以需要一些“写死”的逻辑来把采集任务钉在优先级最高的位置上，这会降低任务模块的条理性。

从终极目标来看，只考虑体型的话，采集任务完全可以并入任务队列，但是对框架提出了更高级的要求，故现阶段能量采集任务不并入工作任务。