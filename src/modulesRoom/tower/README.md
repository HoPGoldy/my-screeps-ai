# tower 防御模块

tower 模块其实包含两部分功能：**防御** 和 **刷墙**。

防御功能负责识别房间内的敌对 creep，进行攻击或启动主动防御，位于 `./hooks/useTower` 中。

刷墙功能负责给工作单位提供刷墙目标，内置了 nuker 防御刷墙，位于 `./hooks/useWall` 中。

## 刷墙

刷墙功能会存储一个墙的 id 和过期时间（一般都是 100t）。在过期时间之前，会一直让工人刷这个墙。

在过期之后，会查找新的墙壁，查找时会优先选择 nuker 检测器提供的防御位置，若没有就选择生命值最低的墙壁。

**注意**：builder 在修建新的 rempart 时会移除该属性（强制刷新，让 tower 可以立刻发现新的 rempart）。

## 主动防御

主动防御是指房间的 tower 防御机制无法有效的消灭敌人时孵化 creep 进行反击和增强维修的功能。

### 模式切换（日常 > 主动）

房间内的敌人总身体部件超过 50（超过一个满配 creep）

如果敌人是 npc 入侵者则不会切换状态

### 主动模式

下列步骤将会依次进行

- tower 停止刷墙工作。
- 房间进入战争状态，通知 manager 搬运强化化合物。
- 发布维修工，主动维修受到攻击的墙体。
- 化合物搬运完成后发布 Defender 单位，主动进攻敌人。
- Defender 孵化完成后 tower 将治疗 Defender 置为优先目标。

### 模式切换（主动 > 日常）

- Defender 老死时房间内不存在敌方单位

满足以上条件则切换至日常模式并解除战争状态
