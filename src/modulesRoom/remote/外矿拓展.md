# 如何发展一个外矿（已实装）

## 相关角色

- `remoteHarvester`：外矿采集者，从外矿采集能量并转移到指定建筑
- `reserver`：预定者，负责持续预定房间

## 基本流程

在源房间上执行如下命令来拓展一个外矿：

```js
// 添加外矿，参数1是外矿房间名，参数2是能量搬回来之后放到哪个建筑里
W1N1.radd('W1N2', '1b7f99a0a')
```

```js
// 移除外矿，参数是要移除的外矿名称
W1N1.rremove('W1N2')
```

执行完成后会提示外矿 Source 上要插的 flag 名称，插好后重新执行即可。

# 采集者逻辑

isNeed:

- 如果没有对应的 source 旗帜则不生成
- 如果外矿房间有入侵者存在则不生成

prepare:

- 移动至外矿房间
- 查找对应旗帜下的 source 并写入缓存
- 检查房间内是否有工地，没有的话这辈子就再也不检查了

source:

- 采集满了执行 target
- 掉血了么？掉血了就通知孵化房间 1500t 后再孵化本房间的单位
- 采集能量
- 检查采集结果，如果发现本房间内有 core，则通知孵化房间等到 core 消失后再进行孵化
- 采集返回 OK 时，如果发现 Source 上限掉回 1500 就发布预订者

工作阶段：

- 向能量存放建筑移动
- 检查自己脚下的 road，如果掉血就进行修复
- 能量放完执行 source

# 预订者逻辑

isNeed:

- 一次性单位，不会自维持孵化

prepare:

- 进入房间则准备结束，否则进行移动

target：

- 向指定控制器移动
- 查看控制器是否为自己的
    - 是自己的，继续预定
    - 不是自己的，攻击控制器

# 入侵者应对策略

- 采集者会监听自己的生命值，一旦出现生命值下降则向出生房间发送信息来暂时禁止重生，预订者不会检查（因为有预订者的房间一定有采集者）。
- 出生房间的 controller 会负责监听采集者发回的消息，并在入侵者老死之后重新发布外矿单位。