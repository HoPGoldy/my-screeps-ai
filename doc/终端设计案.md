# 终端设计案（已实装）

## 需求

- 保持房间中指定矿物的数量
- 可以卖出指定货物
- 可以快捷的向其他房间发送矿物

## 操作

- 添加监听矿物
- 移除监听矿物
- 查看监听列表

## 规则

- 每 10 tick 执行一次，并且仅在冷却完成后才开始工作 [节省 cpu]
- 存有一个索引，遇到下述情况时将索引指向下一个监听矿物 [保证所有矿物都可以被处理]
    - 监听的矿物符合期望后
    - 不符合期望的矿物没有找到合适的订单
- 不符合期望的资源找到了合适的订单后，将会把订单号保存到 room memory，并请求中央物流发来路费的能量
    - 下个 tick 时 terminal 会优先处理该订单

## 监听规则

监听规则分为两种：`buy` 和 `sell`，每种规则都包含不同的交易策略，详见下：

- buy：被监听的资源低于设置的数量时才触发**补货**操作
    - release: 发布订单
    - take: 拍下订单（默认）
    - share: 请求共享
- sell：被监听的资源超出设置的数量时才触发**卖出**操作
    - release: 发布订单
    - take: 拍下订单（默认）

监听规则除了类型和策略外还有第三个参数：”价格限制“：

默认情况下价格是根据要交易资源历史价格的某个区间（定义在 `setting.ts` 的 `DEAL_RATIO`），在指定了价格限制后资源交易将优先应用该限制，在 buy 类型的规则中，该限制为购买的最高价格，在 sell 规则中，该限制为卖出的最低价格。

## 前提

- 所有元素矿及化合物都储存在终端里
- storage 里有能量可以使用