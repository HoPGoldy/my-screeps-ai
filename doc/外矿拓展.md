# 如何发展一个外矿（已实装 - 可优化）

本文档介绍如何拓展外矿

## 相关角色

- `remoteHarvester`：外矿采集者，从外矿采集能量并转移到指定建筑
- `reserver`：预定者，负责持续预定房间

## 基本流程

在源房间上执行如下命令来拓展一个外矿：

```js
// 添加外矿，参数1是外矿房间名，参数2是能量搬回来之后放到哪个建筑里
W1N1.addRemote('W1N2', '1b7f99a0a')
```

```js
// 移除外矿，参数是要移除的外矿名称
W1N1.removeRemote('W1N2')
```

在`creepConfigs`中添加如下角色来拓展一个外矿：

```js
// 外矿采集者
// 外矿旗帜不要放在 source 上，它的位置其实是采集者要站的位置
RemoteHarvester1: role.remoteHarvester('出生点名称', '外矿 source 旗帜', '能量要转移到的建筑id'),

// 外矿预定者
RemoteResever1: role.reserver('出生点名称', '要预定的房间名称')
```

# 持久化

RoomMemory

```ts
remote: {
    // 每个外矿对应一个配置项
    [remoteRoomName: string]: {
        // 该外矿禁止生成的截至时间
        // 该时间到了之后 controller 会重新发布外矿角色
        disableTill: number
    }
}
```

# 采集者逻辑

准备阶段: 

1. 检查旗帜所在的房间是否有视野，如果有的话就查找附件的 source 并写入内存，没有的话就继续移动
2. 检查目标房间是否有建筑工地，如果有则优先建造，没有则此生不再检查

工作阶段：

1. 从当前位置移动到外矿旗帜位置并采集能量
2. 采集完成后返回目标结构
3. 每移动一次检查脚下的道路是否存在
    1. 若存在，则检查是否需要维修, 若需要维修，则维修
4. 移动到目标位置，转移能量。

# 预订者逻辑

准备阶段: 

1. 向指定房间移动

工作阶段：

1. 向指定控制器移动
2. 查看控制器是否为自己的
    1. 是自己的，继续预定
    2. 不是自己的，攻击控制器

# 入侵者应对策略

- 采集者会每 10 tick 检查一次房间内有没有敌人，而预订者不会检查（因为有预订者的房间一定有采集者）。
- 发现敌人后会向自己出生点所在的房间发送信息来暂时禁止外矿房间 creep 的重生，“老死”入侵者。